## ekoparty_pre-ctf: crypto100

----------
## Challenge details
| Contest        | Challenge     | Category  | Points |
|:---------------|:--------------|:----------|-------:|
| ekoparty_pre-ctf | RSA 2070 | Crypto |    100 |



>*Description*
> Recover the private key and the flag.
> Attachment: crypto100.zip 

----------
## Write-up

The public.key file contains (gasp) a public key, based on the challenge name we assume it is RSA:

Use a python script to extract the modulus and exponent:

>```python
>#!/usr/bin/python
>
>from Crypto.PublicKey import RSA
>
>f = open("public.key", 'r')
>externKey = f.read()
>f.close()
>
>pubkey = RSA.importKey(externKey)
>print "N: " + str(pubkey.n)
>print "E: " + str(pubkey.e)
>```

>```
>$ ./decrypt.py 
>N: 79832181757332818552764610761349592984614744432279135328398999801627880283610900361281249973175805069916210179560506497075132524902086881120372213626641879468491936860976686933630869673826972619938321951599146744807653301076026577949579618331502776303983485566046485431039541708467141408260220098592761245010678592347501894176269580510459729633673468068467144199744563731826362102608811033400887813754780282628099443490170016087838606998017490456601315802448567772411623826281747245660954245413781519794295336197555688543537992197142258053220453757666537840276416475602759374950715283890232230741542737319569819793988431443
>E: 65537
>```

I use [yafu](http://sourceforge.net/projects/yafu/) to factor this N:

>```
>$./yafu 
>detected L1 = 32768 bytes, L2 = 6291456 bytes, CL = 64 bytes
>using 20 random witnesses for Rabin-Miller PRP checks
>
>===============================================================
>======= Welcome to YAFU (Yet Another Factoring Utility) =======
>=======             bbuhrow@gmail.com                   =======
>=======     Type help at any time, or quit to quit      =======
>===============================================================
>cached 78498 primes. pmax = 999983
>
>
>>> factor(79832181757332818552764610761349592984614744432279135328398999801627880283610900361281249973175805069916210179560506497075132524902086881120372213626641879468491936860976686933630869673826972619938321951599146744807653301076026577949579618331502776303983485566046485431039541708467141408260220098592761245010678592347501894176269580510459729633673468068467144199744563731826362102608811033400887813754780282628099443490170016087838606998017490456601315802448567772411623826281747245660954245413781519794295336197555688543537992197142258053220453757666537840276416475602759374950715283890232230741542737319569819793988431443)
>
>fac: factoring 79832181757332818552764610761349592984614744432279135328398999801627880283610900361281249973175805069916210179560506497075132524902086881120372213626641879468491936860976686933630869673826972619938321951599146744807653301076026577949579618331502776303983485566046485431039541708467141408260220098592761245010678592347501894176269580510459729633673468068467144199744563731826362102608811033400887813754780282628099443490170016087838606998017490456601315802448567772411623826281747245660954245413781519794295336197555688543537992197142258053220453757666537840276416475602759374950715283890232230741542737319569819793988431443
>fac: using pretesting plan: normal
>fac: no tune info: using qs/gnfs crossover of 95 digits
>div: primes less than 10000
>fmt: 1000000 iterations
>rho: x^2 + 3, starting 1000 iterations on C623 
>rho: x^2 + 2, starting 1000 iterations on C623 
>Total factoring time = 0.4621 seconds
>
>
>***factors found***
>
>P7 = 3133337
>PRP617 = 25478326064937419292200172136399497719081842914528228316455906211693118321971399936004729134841162974144246271486439695786036588117424611881955950996219646807378822278285638261582099108339438949573034101215141156156408742843820048066830863814362379885720395082318462850002901605689761876319151147352730090957556940842144299887394678743607766937828094478336401159449035878306853716216548374273462386508307367713112073004011383418967894930554067582453248981022011922883374442736848045920676341361871231787163441467533076890081721882179369168787287724769642665399992556052144845878600126283968890273067575342061776244939
>```

Now that we have p, q: we can finish the decryption script, we need to use PKCS1_OAEP mode to succesfully decrypt this message.

>```
>#!/usr/bin/python
>
>import gmpy
>from Crypto.PublicKey import RSA
>from Crypto.Cipher import PKCS1_OAEP
>
>f = open("public.key", 'r')
>externKey = f.read()
>f.close()
>
>pubkey = RSA.importKey(externKey)
># print "N: " + str(pubkey.n)
># print "E: " + str(pubkey.e)
>
>p = 3133337
>q = 25478326064937419292200172136399497719081842914528228316455906211693118321971399936004729134841162974144246271486439695786036588117424611881955950996219646807378822278285638261582099108339438949573034101215141156156408742843820048066830863814362379885720395082318462850002901605689761876319151147352730090957556940842144299887394678743607766937828094478336401159449035878306853716216548374273462386508307367713112073004011383418967894930554067582453248981022011922883374442736848045920676341361871231787163441467533076890081721882179369168787287724769642665399992556052144845878600126283968890273067575342061776244939
>
>d = long(gmpy.invert(pubkey.e, (p-1)*(q-1)))
>
>privkey = RSA.construct((pubkey.n, pubkey.e, d, ))
>privpkcs1 = PKCS1_OAEP.new(privkey)
>with open('flag.enc', 'rb') as f:
    >c = f.read().decode('base64')
>f.close()
>print privpkcs1.decrypt(c)
>```

>```
>./decrypt.py 
>EKO{classic_rsa_challenge_is_boring_but_necessary}
>```

The flag is:

>```
>EKO{classic_rsa_challenge_is_boring_but_necessary}
>```
